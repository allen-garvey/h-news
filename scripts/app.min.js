HN.Story=function(){function t(t){this.storyInfo=t}return t.prototype.url=function(){return this.isLocalHNUrl()?HN.askUrl+this.storyInfo.id:this.storyInfo.url},t.prototype.isLocalHNUrl=function(){return this.storyInfo.url?!1:!0},t.prototype.urlRoot=function(){if(this.isLocalHNUrl())return"";var t=this.url();return t=t.replace(/^http(s)?:\/\/(www.)?/,""),t=t.replace(/\/.*$/,""),"("+t.replace(/\?.*$/,"")+")"},t.prototype.title=function(){return this.storyInfo.title||""},t.prototype.text=function(){return this.storyInfo.text||""},t.prototype.author=function(){return this.storyInfo.by||""},t.prototype.storyType=function(){return"story"!==this.type()?!1:this.isLocalHNUrl()?"ask"===this.title().substring(0,3).toLowerCase()?"ask":"show":"story"},t.prototype.type=function(){return this.storyInfo.type},t.prototype.numComments=function(){return this.storyInfo.descendants?this.storyInfo.descendants:0},t.prototype.getTopLevelCommentsIds=function(){return this.storyInfo.kids?this.storyInfo.kids:[]},t.prototype.commentsUrl=function(){return HN.commentsUrl+this.storyInfo.id},t}(),HN.Comment=function(){function t(t){this.commentInfo=t}return t.prototype.isDeleted=function(){return this.commentInfo.deleted===!0?!0:!1},t.prototype.children=function(){return this.commentInfo.kids},t.prototype.parentId=function(){return this.commentInfo.parent},t.prototype.text=function(){return this.commentInfo.text},t.prototype.author=function(){return this.commentInfo.by},t.prototype.commentId=function(){return this.commentInfo.id},t.prototype.numChildren=function(){return this.children()?this.children().length:0},t}(),HN.util={},HN.util.getItemInfoUrlFromId=function(t){return"https://hacker-news.firebaseio.com/v0/item/"+t+".json"},HN.util.getStoryTitleHTML=function(t){var e="<a href='"+t.url()+"'><h3>"+t.title();return""!==t.urlRoot()&&(e+="<span class='small url_source'> "+t.urlRoot()+"</span>"),e+="</h3></a>"},HN.util.getAskStoryTitle=function(t){return"<h3>"+t.title()+"</h3>"},HN.util.smartenQuotesHTML=function(t){return HN.util.replaceSmartQuoteEntities(HN.util.transformTextNodes(t,function(t){return HN.util.replaceDumbQuotes(t)}))},HN.util.transformTextNodes=function(t,e){var n=typeof t;if("string"===n){var o=document.createElement("div");o.innerHTML=t,t=o}try{var r=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1)}catch(i){return console.log(i),t}for(var s;s=r.nextNode();)s.nodeValue=e(s.nodeValue);return"string"===n?t.innerHTML:t},HN.util.replaceDumbQuotes=function(t){var e="&#8217;",n="&#8216;",o="&#8221;",r="&#8220;",i="&#8212;",s="&#8230;";return t.replace(/\b'|[\.?,-\/#!$%\^&\*;:{}<>=|\-_`~()\[\]]'/g,function(t,n,o){return t.replace(/'/g,e)}).replace(/'/g,n).replace(/\b"|[\.?,-\/#!$%\^&\*;:{}<>|=\-_`~()\[\]]"/g,function(t,e,n){return t.replace(/"/g,o)}).replace(/"/g,r).replace(/\D\s+-+\s*\D|\D\s*-+\s+\D|\s*--+\s*/g,function(t,e,n){return t.replace(/\s*-+\s*/g,i)}).replace(/\.\s?\.\s?\.\s?/g,s)},HN.util.replaceSmartQuoteEntities=function(t){return"string"!=typeof t?t:t.replace(/&amp;#[\d]{4};/g,function(t,e,n){return t.replace("&amp;","&")})},HN.getJSON=function(t,e,n){var o=new XMLHttpRequest;o.open("GET",t,!0),o.onload=function(){if(this.status>=200&&this.status<400){var t=JSON.parse(this.response);e(t)}else n(this.response)},o.onerror=function(){n(this.response)},o.send()},HN.util.each=function(t,e){for(var n=t.length,o=0;n>o;o++)e(t[o],o)},HN.util.redirectLinks=function(){var t="https://news.ycombinator.com/item?id=",e=document.querySelectorAll("#top_list a[href^='"+t+"']");HN.util.each(e,function(e){var n=e.href.split(t);if(2===n.length){var o=n[1];if(o.match(/^[0-9]*$/)){var r=HN.settings.commentsUrl+o;e.setAttribute("href",r),e.text=r}}})},HN.displayStories=function(){function t(t){for(var n=document.getElementById("top_list"),o=0;o<HN.storiesPerPage;o++){var r=HN.util.getItemInfoUrlFromId(t[o]);r&&HN.getJSON(r,function(r){if(!r)return void console.log("Story info is: "+r+" for story id: "+t[o]);var i=new HN.Story(r);HN.shouldDisplayStory(i)&&n.insertAdjacentHTML("beforeend",e(i))},function(){console.log("failed to get info about story: "+story.id)})}}function e(t){var e="<li><div class='container'>"+HN.util.getStoryTitleHTML(t),n=t.numComments();if(n>0){var o=" comment";n>1&&(o=" comments"),e=e+"<a href='"+t.commentsUrl()+"'><p>"+n+o+"</p></a>"}return e+="</div></li>"}HN.getJSON(HN.storiesUrl,function(e){t(e)},function(){console.log("Error retrieving story ids")})},HN.clearComments=function(){document.getElementById("content_main").innerHTML=""},HN.displayComments=function(){function t(t,n){if(t){for(var o=!n,r=document.getElementById(n?n:"top_list"),i=t.length,s=0;i>s;s++)HN.getJSON(HN.util.getItemInfoUrlFromId(t[s]),function(t){e(t,r,o)},function(){console.log("Error retrieving info about comment: "+t[s])});HN.util.redirectLinks()}}function e(e,r,i){if(e){var s=new HN.Comment(e);s.isDeleted()&&(s=o(e));var c="<li class='comment'>";i&&(c+="<div class='container'>"),c+="<h6>"+s.author()+"</h6><article",s.isDeleted()&&(c+=" class='deleted'"),c+=">"+HN.util.smartenQuotesHTML(s.text())+"</article>",s.numChildren()>0&&(c+="<ol id='"+n(s.commentId())+"'></ol>"),i&&(c+="</div>"),c+="</li>",r.insertAdjacentHTML("beforeend",c),t(s.children(),n(s.commentId()))}}function n(t){return"comment"+t}function o(t){return t.by="",t.text="[deleted]",new HN.Comment(t)}var r=window.location.href.match(/\d+\/?$/);if(!r)return void console.log("No story id found");var i="https://hacker-news.firebaseio.com/v0/item/"+r[0]+".json";HN.getJSON(i,function(e){if(!e)return void console.log("No info about the story returned");var n=new HN.Story(e),o="container",r=n.text(),i="";r?(r="<h6>"+n.author()+"</h6><article>"+HN.util.smartenQuotesHTML(n.text())+"</article>",("ask"===HN.pageName||n.title().match(/^(Ask|Tell) HN:/))&&(o+=" ask",i=HN.util.getAskStoryTitle(n))):i=HN.util.getStoryTitleHTML(n),document.title=document.title+" - "+n.title(),document.getElementById("content_main").insertAdjacentHTML("afterbegin","<section class='"+o+"'>"+i+r+"</section>"),t(n.getTopLevelCommentsIds())},function(){console.log("Error retrieving comments")})},HN.settings.LS_AUTODARK_KEY="Local Storage Key for automatically changing to dark theme at night",HN.settings.LS_USER_THEME_KEY="Local Storage Key user selected theme",HN.settings.initSettingsPage=function(){var t=window.localStorage;"true"===t.getItem(HN.settings.LS_AUTODARK_KEY)&&(document.getElementById("autodark_checkbox").checked=!0);var e=HN.settings.getUserTheme();HN.settings.themeNames.map(function(t){var n=document.getElementById(HN.settings.themeIdPrefix+t);t===e&&(n.checked=!0),n.onclick=function(){document.documentElement.className=t}})},HN.settings.getUserTheme=function(){var t=window.localStorage,e=t.getItem(HN.settings.LS_USER_THEME_KEY);return HN.settings.themeNames.indexOf(e)<0&&(e=HN.settings.themeNames[0]),e},HN.settings.initSettings=function(){document.documentElement.className=HN.settings.getUserTheme();var t=window.localStorage;"true"===t.getItem(HN.settings.LS_AUTODARK_KEY)&&HN.settings.darkAtNight()},HN.settings.darkAtNight=function(){var t=new Date,e=t.getHours();(e>=22||6>e)&&(document.documentElement.className="dark")},HN.settings.save=function(){var t=window.localStorage;t.setItem(HN.settings.LS_AUTODARK_KEY,document.getElementById("autodark_checkbox").checked);var e=document.querySelector('input[name="'+HN.settings.userThemeFormName+'"]:checked').value;HN.settings.themeNames.indexOf(e)>=0&&t.setItem(HN.settings.LS_USER_THEME_KEY,e),window.location.href=document.querySelector("form").action},HN.settings.initSettings(),"comments"===HN.pageType?(window.addEventListener("hashchange",function(){HN.clearComments(),HN.displayComments()},!1),HN.displayComments()):"settings"===HN.pageType?HN.settings.initSettingsPage():HN.displayStories();